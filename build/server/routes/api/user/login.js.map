{"version":3,"file":"login.js","sources":["../../../../../server/routes/api/user/login.ts"],"sourcesContent":["import { Router, Request, Response } from \"express\";\nimport User from \"../../../../db/models/user\";\n\nconst router: Router = Router();\n\nrouter.post(\"/\", async (req: Request, res: Response) => {\n  const {\n    username,\n    email,\n    password,\n  }: { username: string; email: string; password: string } = req.body;\n  let searchClause = {};\n\n  if ((!username && !email) || !password)\n    return res.json({\n      success: false,\n      message: \"Username/email and password required\",\n    });\n\n  if (email && email.indexOf(\"@\") != -1) {\n    searchClause = { email: email };\n  } else if (email && email.indexOf(\"@\") == -1) {\n    searchClause = { username: email };\n  } else {\n    username && username.indexOf(\"@\") != -1\n      ? (searchClause = { email: username })\n      : (searchClause = { username: username });\n  }\n\n  const foundUser = await User.findOne(searchClause);\n\n  if (!foundUser) {\n    return res.json({\n      success: false,\n      message: `User not found with ${Object.keys(searchClause)[0]} ${\n        Object.values(searchClause)[0]\n      }`, //Username can be email or username\n    });\n  }\n\n  if ((await foundUser.comparePassword(password)) === false) {\n    return res.json({ success: false, message: \"Incorrect password\" });\n  }\n\n  const userNoPass = foundUser.toJSON();\n\n  req.session.user = userNoPass;\n\n  res.json({\n    success: true,\n    message: \"User logged in\",\n    user: userNoPass,\n  });\n});\n\nexport default router;\n"],"names":[],"mappings":";;;AAGA,MAAM,MAAM,GAAW,MAAM,GAAG;AAEhC,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,OAAO,GAAY,EAAE,GAAa,KAAI;IACrD,MAAM,EACJ,QAAQ,EACR,KAAK,EACL,QAAQ,GACT,GAA0D,GAAG,CAAC,IAAI,CAAC;IACpE,IAAI,YAAY,GAAG,EAAE,CAAC;IAEtB,IAAI,CAAC,CAAC,QAAQ,IAAI,CAAC,KAAK,KAAK,CAAC,QAAQ;QACpC,OAAO,GAAG,CAAC,IAAI,CAAC;AACd,YAAA,OAAO,EAAE,KAAK;AACd,YAAA,OAAO,EAAE,sCAAsC;AAChD,SAAA,CAAC,CAAC;AAEL,IAAA,IAAI,KAAK,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE;AACrC,QAAA,YAAY,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC;KACjC;AAAM,SAAA,IAAI,KAAK,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE;AAC5C,QAAA,YAAY,GAAG,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;KACpC;SAAM;QACL,QAAQ,IAAI,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;eAClC,YAAY,GAAG,EAAE,KAAK,EAAE,QAAQ,EAAE;eAClC,YAAY,GAAG,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,CAAC;KAC7C;IAED,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;IAEnD,IAAI,CAAC,SAAS,EAAE;QACd,OAAO,GAAG,CAAC,IAAI,CAAC;AACd,YAAA,OAAO,EAAE,KAAK;YACd,OAAO,EAAE,uBAAuB,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,IAC1D,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC,CAC/B,CAAE,CAAA;AACH,SAAA,CAAC,CAAC;KACJ;AAED,IAAA,IAAI,CAAC,MAAM,SAAS,CAAC,eAAe,CAAC,QAAQ,CAAC,MAAM,KAAK,EAAE;AACzD,QAAA,OAAO,GAAG,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,oBAAoB,EAAE,CAAC,CAAC;KACpE;AAED,IAAA,MAAM,UAAU,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC;AAEtC,IAAA,GAAG,CAAC,OAAO,CAAC,IAAI,GAAG,UAAU,CAAC;IAE9B,GAAG,CAAC,IAAI,CAAC;AACP,QAAA,OAAO,EAAE,IAAI;AACb,QAAA,OAAO,EAAE,gBAAgB;AACzB,QAAA,IAAI,EAAE,UAAU;AACjB,KAAA,CAAC,CAAC;AACL,CAAC,CAAC;;;;"}