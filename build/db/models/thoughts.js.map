{"version":3,"file":"thoughts.js","sources":["../../../db/models/thoughts.ts"],"sourcesContent":["import mongoose, { Schema, model, Document, ObjectId } from \"mongoose\";\n\nexport interface IThought extends Document {\n  thoughtText: string;\n  username: string;\n  createdAt: Date | string;\n  reactions: ObjectId[];\n}\n\nconst thoughtSchema = new Schema<IThought>(\n  {\n    thoughtText: {\n      type: String,\n      required: true,\n      minlength: 1,\n      maxlength: 280,\n    },\n    username: {\n      type: String,\n      required: true,\n    },\n    createdAt: {\n      type: Date,\n      default: Date.now(),\n      get: (createdAt: Date) => createdAt.toLocaleDateString(),\n    },\n    reactions: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: \"Reaction\",\n        default: [],\n        required: true,\n      },\n    ],\n  },\n  {\n    //Stop JSON from returning _id and id\n    id: false,\n    toJSON: { getters: true },\n  }\n);\n\nthoughtSchema.pre(\n  \"deleteOne\",\n  { document: true, query: false },\n  async function (next) {\n    const user = await mongoose\n      .model(\"User\")\n      .findOne({ username: this.username });\n    if (!user) return next();\n\n    for (let i = 0; i < user.thoughts.length; i++) {\n      if ((await Thought.findById(user.thoughts[i])) === null) {\n        user.thoughts.splice(i, 1);\n      }\n    }\n\n    await user.save();\n\n    const updatedUser = await mongoose\n      .model(\"User\")\n      .findOneAndUpdate(\n        { username: this.username },\n        { $pull: { thoughts: this._id } },\n        { returnDocument: \"after\" }\n      );\n\n    return next();\n  }\n);\n\nconst Thought = model<IThought>(\"Thought\", thoughtSchema);\n\nexport default Thought;\n"],"names":[],"mappings":";;AASA,MAAM,aAAa,GAAG,IAAI,MAAM,CAC9B;AACE,IAAA,WAAW,EAAE;AACX,QAAA,IAAI,EAAE,MAAM;AACZ,QAAA,QAAQ,EAAE,IAAI;AACd,QAAA,SAAS,EAAE,CAAC;AACZ,QAAA,SAAS,EAAE,GAAG;AACf,KAAA;AACD,IAAA,QAAQ,EAAE;AACR,QAAA,IAAI,EAAE,MAAM;AACZ,QAAA,QAAQ,EAAE,IAAI;AACf,KAAA;AACD,IAAA,SAAS,EAAE;AACT,QAAA,IAAI,EAAE,IAAI;AACV,QAAA,OAAO,EAAE,IAAI,CAAC,GAAG,EAAE;QACnB,GAAG,EAAE,CAAC,SAAe,KAAK,SAAS,CAAC,kBAAkB,EAAE;AACzD,KAAA;AACD,IAAA,SAAS,EAAE;AACT,QAAA;AACE,YAAA,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,QAAQ;AAC3B,YAAA,GAAG,EAAE,UAAU;AACf,YAAA,OAAO,EAAE,EAAE;AACX,YAAA,QAAQ,EAAE,IAAI;AACf,SAAA;AACF,KAAA;CACF,EACD;;AAEE,IAAA,EAAE,EAAE,KAAK;AACT,IAAA,MAAM,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE;AAC1B,CAAA,CACF,CAAC;AAEF,aAAa,CAAC,GAAG,CACf,WAAW,EACX,EAAE,QAAQ,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,EAChC,gBAAgB,IAAI,EAAA;IAClB,MAAM,IAAI,GAAG,MAAM,QAAQ;SACxB,KAAK,CAAC,MAAM,CAAC;SACb,OAAO,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;AACxC,IAAA,IAAI,CAAC,IAAI;QAAE,OAAO,IAAI,EAAE,CAAC;AAEzB,IAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC7C,QAAA,IAAI,CAAC,MAAM,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,IAAI,EAAE;YACvD,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;SAC5B;KACF;AAED,IAAA,MAAM,IAAI,CAAC,IAAI,EAAE,CAAC;IAEE,MAAM,QAAQ;SAC/B,KAAK,CAAC,MAAM,CAAC;SACb,gBAAgB,CACf,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,EAC3B,EAAE,KAAK,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,GAAG,EAAE,EAAE,EACjC,EAAE,cAAc,EAAE,OAAO,EAAE,EAC3B;IAEJ,OAAO,IAAI,EAAE,CAAC;AAChB,CAAC,CACF,CAAC;AAEI,MAAA,OAAO,GAAG,KAAK,CAAW,SAAS,EAAE,aAAa;;;;"}